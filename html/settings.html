
<style>
.settings-content .tab-content {
    background-color: #fff;
    border-bottom-left-radius: 5px;
    border-bottom-right-radius: 5px;
}
.settings-content .nav-tabs>li.active>a {
    border: 1px solid #ccc;
    border-bottom-color: transparent;
}
.settings-content fieldset {
    max-width: 600px;
}
</style>

<!-- Settings Form -->
<div class="settings-content">
    <form class="form-horizontal" id="settings-form" data-toggle="validator" role="form">
    <div class="row">
        <div class="col-xs-12">
            <ul class="nav nav-tabs">
                <li class="active">
                    <a data-toggle="tab" href="#wallet"><i class="fa fa-bitcoin"></i> Wallet</a></li>
                <li><a data-toggle="tab" href="#preferences"><i class="fa fa-cog"></i> Preferences</a></li>
                <li><a data-toggle="tab" href="#apikeys"><i class="fa fa-key"></i> API Keys</a></li>
                <li><a data-toggle="tab" href="#servers"><i class="fa fa-server"></i> Server Settings</a></li>
            </ul>
            <div class="tab-content" style="border: 1px solid #ccc; border-top: 0px !important;padding: 10px">
                <!-- Wallet Settings -->
                <div id="wallet" class="tab-pane active">
                    <fieldset>
                        <div class="form-group">
                            <label for="passphrase" class="col-sm-3 control-label no-right-padding">
                                Passphrase
                                <a href="#" data-toggle="tooltip" title='This is the 12-word passphrase that enables you to access all your funds' class="pull-right"><i class="fa fa-lg fa-question-circle-o margin-top-5" ></i></a>
                            </label>
                            <div class="col-sm-9">
                                <div class="input-group">
                                    <input type="password" class="form-control" name="passphrase" id="passphrase" placeholder="Current Passphrase" value="word word word word word word word word word word word word" readonly>
                                    <a href="#" class="input-group-addon" id="settings-passphrase"><i class="fa fa-eye"></i></a>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="address" class="col-sm-3 control-label no-right-padding">
                                Address
                                <a href="#" data-toggle="tooltip" title='This is the current wallet address' class="pull-right"><i class="fa fa-lg fa-question-circle-o margin-top-5" ></i></a>
                            </label>
                            <div class="col-sm-9">
                                <div class="input-group">
                                    <input type="text" class="form-control" name="address"  id="settings-address" placeholder="Current Address" readonly>
                                    <a class="input-group-addon" id="settings-address-icon"><i class="fa fa-edit"></i></a>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="settings-address-label" class="col-sm-3 control-label no-right-padding">
                                Label
                                <a href="#" data-toggle="tooltip" title='This is the name or label you would like to use for the current address' class="pull-right"><i class="fa fa-lg fa-question-circle-o margin-top-5" ></i></a>
                            </label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" name="settings-address-label"  id="settings-address-label" placeholder="Address Label">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="network" class="col-sm-3 control-label no-right-padding">
                                Network
                                <a href="#" data-toggle="tooltip" title='This determines which bitcoin network you would prefer to use' class="pull-right"><i class="fa fa-lg fa-question-circle-o margin-top-5" ></i></a>
                            </label>
                            <select class="col-sm-9 selectpicker" name="network" id="settings-network">
                                <option value="1">Unobtanium Core (Mainnet)</option>
                                <option value="2">Unobtanium Core (Testnet)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="settings-largefee" class="col-sm-3 control-label no-right-padding">
                              Fees
                              <a href="#" data-toggle="tooltip" title="This can enable tx to succeed with a high fee. When disabled, a high TX fee will cause the tx to fail" class="pull-right"><i class="fa fa-lg fa-question-circle-o margin-top-5" ></i></a>
                            </label>
                            <select class="col-sm-9 selectpicker" name="settings-largefee" id="settings-largefee">
                                <option value="0">Disable Large Fees</option>
                                <option value="1">Enable Large Fees</option>
                            </select>
                        </div>
                    </fieldset>
                </div>
                <!-- General Preferences -->
                <div id="preferences" class="tab-pane">
                    <fieldset>
                        <div class="form-group">
                            <label for="current-theme" class="col-sm-3 control-label no-right-padding">
                                Theme
                                <a href="#" data-toggle="tooltip" title='This is the current theme being used' class="pull-right"><i class="fa fa-lg fa-question-circle-o margin-top-5" ></i></a>
                            </label>
                            <select class="col-sm-9 selectpicker" name="current-theme"  id="current-theme">
                                <option>Default</option>
                                <option>Coming soon...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="current-currency" class="col-sm-3 control-label no-right-padding">
                                Currency
                                <a href="#" data-toggle="tooltip" title='This is the current currency being used to display fiat values' class="pull-right"><i class="fa fa-lg fa-question-circle-o margin-top-5" ></i></a>
                            </label>
                            <select class="col-sm-9 selectpicker" name="current-currency"  id="current-currency">
                                <option data-icon="fa fa-usd">US Dollar</option>
                                <option>Coming soon...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="current-language" class="col-sm-3 control-label no-right-padding">
                                Language
                                <a href="#" data-toggle="tooltip" title='This is the current language being used in the wallet' class="pull-right"><i class="fa fa-lg fa-question-circle-o margin-top-5" ></i></a>
                            </label>
                            <select class="col-sm-9 selectpicker"  name="current-language" id="current-language">
                                <option>English</option>
                                <option>Coming soon...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="current-priority" class="col-sm-3 control-label no-right-padding">
                                Fee Priority
                                <a href="#" data-toggle="tooltip" title='This is the default fee priority that you would like to use' class="pull-right"><i class="fa fa-lg fa-question-circle-o margin-top-5" ></i></a>
                            </label>
                            <select class="col-sm-9 selectpicker" name="current-priority" id="current-priority">
                                <option>High</option>
                                <option>Medium</option>
                                <option>Low</option>
                                <option>Custom</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="minimum-tx-fee" class="col-sm-3 control-label no-right-padding">
                                Minimum Fee
                                <a href="#" data-toggle="tooltip" title='This is the minimum transaction fee you want to pay on any transaction' class="pull-right"><i class="fa fa-lg fa-question-circle-o margin-top-5" ></i></a>
                            </label>
                            <div class="col-sm-9">
                                <div class="input-group">
                                    <input type="text" class="form-control" name="minimum-tx-fee" id="minimum-tx-fee" placeholder="Minimum Transaction Fee">
                                    <a href="#" class="input-group-addon" id="reset-min-fee">Reset</a>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                </div>
                <!-- API Keys -->
                <div id="apikeys" class="tab-pane">
                    <fieldset>
                        <div class="form-group">
                            <label for="api-key-pastebin" class="col-sm-3 control-label no-right-padding">
                                Pastebin
                                <a href="#" data-toggle="tooltip" title='This is the API key for the pastebin.com API' class="pull-right"><i class="fa fa-lg fa-question-circle-o margin-top-5" ></i></a>
                            </label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" name="api-key-pastebin" id="api-key-pastebin">
                            </div>
                        </div>
                    </fieldset>
                </div>
                <!-- Server Settings -->
                <div id="servers" class="tab-pane">
                    <fieldset>
                        <legend>Mainnet</legend>
                        <div class="form-group">
                            <label for="mainnet-api-host" class="col-sm-3 control-label no-right-padding">
                                API Host
                                <a href="#" data-toggle="tooltip" title='This is the hostname where the XChain API can be accessed' class="pull-right"><i class="fa fa-lg fa-question-circle-o margin-top-5" ></i></a>
                            </label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" name="mainnet-api-host" id="mainnet-api-host" placeholder="xchain.io" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="mainnet-api-ssl" class="col-sm-3 control-label no-right-padding">
                                API SSL
                                <a href="#" data-toggle="tooltip" title='This determines if requests to the XChain API use http or https (ssl)' class="pull-right"><i class="fa fa-lg fa-question-circle-o margin-top-5" ></i></a>
                            </label>
                            <select class="col-sm-9 selectpicker" name="mainnet-api-ssl" id="mainnet-api-ssl">
                                <option value="1">Yes</option>
                                <option value="0">No</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="mainnet-cp-host" class="col-sm-3 control-label no-right-padding">
                                CP Host
                                <a href="#" data-toggle="tooltip" title='This is the hostname where the Unoparty API can be accessed' class="pull-right"><i class="fa fa-lg fa-question-circle-o margin-top-5" ></i></a>
                            </label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" name="mainnet-cp-host" id="mainnet-cp-host" placeholder="public.coindaddy.io" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="mainnet-cp-port" class="col-sm-3 control-label no-right-padding">
                                CP Port
                                <a href="#" data-toggle="tooltip" title='This is the port to use when communicating with the Unoparty API' class="pull-right"><i class="fa fa-lg fa-question-circle-o margin-top-5" ></i></a>
                            </label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" name="mainnet-cp-port" id="mainnet-cp-port" placeholder="4000" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="mainnet-cp-user" class="col-sm-3 control-label no-right-padding">
                                CP User
                                <a href="#" data-toggle="tooltip" title='This is the username used to authenticate to the Unoparty API' class="pull-right"><i class="fa fa-lg fa-question-circle-o margin-top-5" ></i></a>
                            </label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" name="mainnet-cp-user" id="mainnet-cp-user" placeholder="rpc" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="mainnet-cp-pass" class="col-sm-3 control-label no-right-padding">
                                CP Pass
                                <a href="#" data-toggle="tooltip" title='This is the password used to authenticate to the Unoparty API' class="pull-right"><i class="fa fa-lg fa-question-circle-o margin-top-5" ></i></a>
                            </label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" name="mainnet-cp-pass" id="mainnet-cp-pass" placeholder="1234" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="mainnet-cp-ssl" class="col-sm-3 control-label no-right-padding">
                                CP SSL
                                <a href="#" data-toggle="tooltip" title='This determines if requests to the Unoparty API use http or https (ssl)' class="pull-right"><i class="fa fa-lg fa-question-circle-o margin-top-5" ></i></a>
                            </label>
                            <select class="col-sm-9 selectpicker" name="mainnet-cp-ssl" id="mainnet-cp-ssl">
                                <option value="1">Yes</option>
                                <option value="0">No</option>
                            </select>
                        </div>
                    </fieldset>
                    <fieldset>
                        <legend>Testnet</legend>
                        <div class="form-group">
                            <label for="testnet-api-host" class="col-sm-3 control-label no-right-padding">
                                API Host
                                <a href="#" data-toggle="tooltip" title='This is the hostname where the XChain API can be accessed' class="pull-right"><i class="fa fa-lg fa-question-circle-o margin-top-5" ></i></a>
                            </label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" name="testnet-api-host" id="testnet-api-host" placeholder="unoparty-testnet.xchain.io" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="mainnet-api-ssl" class="col-sm-3 control-label no-right-padding">
                                API SSL
                                <a href="#" data-toggle="tooltip" title='This determines if requests to the XChain API use http or https (ssl)' class="pull-right"><i class="fa fa-lg fa-question-circle-o margin-top-5" ></i></a>
                            </label>
                            <select class="col-sm-9 selectpicker" name="testnet-api-ssl" id="testnet-api-ssl">
                                <option value="1">Yes</option>
                                <option value="0">No</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="testnet-cp-host" class="col-sm-3 control-label no-right-padding">
                                CP Host
                                <a href="#" data-toggle="tooltip" title='This is the hostname where the Unoparty API can be accessed' class="pull-right"><i class="fa fa-lg fa-question-circle-o margin-top-5" ></i></a>
                            </label>
                            <div class="col-sm-9">
                              <input type="text" class="form-control" name="testnet-cp-host" id="testnet-cp-host" placeholder="public.coindaddy.io" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="testnet-cp-port" class="col-sm-3 control-label no-right-padding">
                                CP Port
                                <a href="#" data-toggle="tooltip" title='This is the port to use when communicating with the Unoparty API' class="pull-right"><i class="fa fa-lg fa-question-circle-o margin-top-5" ></i></a>
                            </label>
                            <div class="col-sm-9">
                              <input type="text" class="form-control" name="testnet-cp-port" id="testnet-cp-port" placeholder="14000" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="testnet-cp-user" class="col-sm-3 control-label no-right-padding">
                                CP User
                                <a href="#" data-toggle="tooltip" title='This is the username used to authenticate to the Unoparty API' class="pull-right"><i class="fa fa-lg fa-question-circle-o margin-top-5" ></i></a>
                            </label>
                            <div class="col-sm-9">
                              <input type="text" class="form-control" name="testnet-cp-user" id="testnet-cp-user" placeholder="rpc" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="testnet-cp-pass" class="col-sm-3 control-label no-right-padding">
                                CP Pass
                                <a href="#" data-toggle="tooltip" title='This is the password used to authenticate to the Unoparty API' class="pull-right"><i class="fa fa-lg fa-question-circle-o margin-top-5" ></i></a>
                            </label>
                            <div class="col-sm-9">
                              <input type="text" class="form-control" name="testnet-cp-pass" id="testnet-cp-pass" placeholder="1234" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="testnet-cp-ssl" class="col-sm-3 control-label no-right-padding">
                                Use SSL
                                <a href="#" data-toggle="tooltip" title='This determines if requests to the Unoparty API use http or https (ssl)' class="pull-right"><i class="fa fa-lg fa-question-circle-o margin-top-5" ></i></a>
                            </label>
                            <select class="col-sm-9 selectpicker" name="testnet-cp-ssl" id="testnet-cp-ssl">
                                <option value="1">Yes</option>
                                <option value="0">No</option>
                            </select>
                        </div>
                    </fieldset>
                </div>
            </div>
        </div>
    </div>
    </form>
<br/><br/>
</div>

<script>
$(document).ready(function(){
    var ls = localStorage,
        ss = sessionStorage;

    // Load the wallet address information
    $('#settings-address').val(FUW.WALLET_ADDRESS);
    $('#settings-network').val(FUW.WALLET_NETWORK);
    $('#settings-address-label').val(FUW.WALLET_ADDRESS_LABEL);
    $('#settings-largefee').val(FUW.ALLOW_LARGEFEE ? "1" : "0");

    // Define possible networks
    var networks = ['mainnet','testnet'];

    // Populate the server info fields
    $.each(networks,function(idx, name){
        var o = FUW.WALLET_SERVER_INFO[name];
        $('#' + name + '-cp-host').val(o.host);
        $('#' + name + '-cp-port').val(o.port);
        $('#' + name + '-cp-user').val(o.user);
        $('#' + name + '-cp-pass').val(o.pass);
        $('#' + name + '-cp-ssl').val((o.ssl) ? 1 : 0);
        $('#' + name + '-api-host').val(o.api_host);
        $('#' + name + '-api-ssl').val((o.api_ssl) ? 1 : 0);
    });

    // Initialize any tooltips
    $('[data-toggle="tooltip"]').tooltip({
        html: true,
        placement: 'bottom'
    });

    // Detect any server settings changes and treat as if user submited form
    $('#servers input, #servers select').change(function(){
        $('#settings-form').submit();
    });

    // Set fee priority based on current value
    var val = ls.getItem('feePriority') || 'High';
    $('#current-priority').val(val);

    var fee = numeral(FUW.MINIMUM_TX_FEE * 0.00000001).format('0.00000000');
    $('#minimum-tx-fee').val(fee);

    // Restore any API keys
    $('#api-key-pastebin').val(ls.getItem('apiKeyPastebin'));


    // Make any selects look nicer by using dialog-select
    $('.selectpicker').selectpicker({
        style: 'btn-default btn-block',
        size: 4
    });

    // Save fee priority when it changes
    $('#current-priority').change(function(e){
        var val = $(this).val();
        ls.setItem('feePriority', val);
    });

    // Save pastebin.com API key
    $('#api-key-pastebin').change(function(){
        var val = $(this).val();
        ls.setItem('apiKeyPastebin', val);
    });

    // Handle resetting the minimum fee
    $('#reset-min-fee').click(function(){
        FUW.MINIMUM_TX_FEE = FUW.MINIMUM_TX_FEE_DEFAULT;
        var fee = numeral(FUW.MINIMUM_TX_FEE * 0.00000001).format('0.00000000');
        $('#minimum-tx-fee').val(fee);
        ls.removeItem('feeMinimum');
    });

    // Handle making sure minimum fee is within sane ranges (250-10,000 satoshis)
    $('#minimum-tx-fee').change(function(){
        var el   = $(this);
            val  = el.val(),
            sats = numeral(numeral(val).format('0.00000000').split('.')[1]).format('0'),
            min  = 250,
            max  = 10000;
        // Force format to 0.00000000
        el.val(numeral(val).format('0.00000000'));
        var errors = [];
        if(sats < min)
            errors.push('Minimum Fee is below minmum of ' + numeral(min).format('0,0') + ' satoshis!');
        if(sats > max)
            errors.push('Minimum Fee is above maximum of ' + numeral(max).format('0,0') + ' satoshis!');
        // Display any error message
        if(errors.length){
            dialogMessage('<i class="fa fa-lg fa-fuw fa-exclamation-circle"></i> Error(s)', errors.join('<br/>'));
            // Reset displayed fee to current setting
            var fee = numeral(FUW.MINIMUM_TX_FEE * 0.00000001).format('0.00000000');
            $('#minimum-tx-fee').val(fee);
        } else {
            // Update minimum fee and save setting
            FUW.MINIMUM_TX_FEE = sats;
            ls.setItem('feeMinimum', sats);
            dialogMessage('<i class="fa fa-lg fa-fuw fa-floppy-o"></i> Minimum Fee Saved', 'Your minimum fee information has been successfully saved.');
        }
    });

    // Handle form validation
    $('#settings-form').validator().on('submit', function(e){
        // handle the invalid form
        if(e.isDefaultPrevented()){
            dialogMessage('<i class="fa fa-lg fa-fuw fa-info-circle"></i> Error', 'Please fill out all required fields indicated in red.');
        } else {
            e.preventDefault();
            // Loop through form data and build out data array
            var arr  = $(this).serializeArray(),
                data = {};
            $(arr).each(function(index, obj){
                data[obj.name] = obj.value;
            });
            // Build out the server data object
            var o = {};
            $.each(networks,function(idx, name){
                o[name] = {
                    host: data[name + '-cp-host'],
                    port: data[name + '-cp-port'],
                    user: data[name + '-cp-user'],
                    pass: data[name + '-cp-pass'],
                    ssl: (data[name + '-cp-ssl']=='1') ? true : false,
                    api_host: data[name + '-api-host'],
                    api_ssl: (data[name + '-api-ssl']=='1') ? true : false,
                };
            });
            // Save updated server information
            FUW.WALLET_SERVER_INFO = o;
            ls.setItem('serverInfo',JSON.stringify(o));
            // Handle setting the xchain URL
            setXChainAPI();
            // dialogMessage('<i class="fa fa-lg fa-fuw fa-info-circle"></i> Information Saved', 'Your server information has been successfully saved.');
        }
    });

    // Show change/edit address list form when user clicks the edit icon
    $('#settings-address-icon').click($.debounce(100,function(e){
        dialogChangeAddress();
    }));

    // Show change/edit address list form when user clicks the qrcode/address
    $('#settings-address-label').change(function(e){
        var label = $(this).val();
        setWalletAddressLabel(FUW.WALLET_ADDRESS, label);
        dialogMessage('<i class="fa fa-lg fa-fuw fa-floppy-o"></i> Address Label Saved', 'Your address label information has been successfully saved.');
    });

    // Show passphrase dialog box when user clicks passphrase view button
    $('#settings-passphrase').click($.debounce(100,function(e){
        // Make sure wallet is unlocked
        if(dialogCheckLocked('view your wallet passphrase'))
            return;
        dialogPassphrase();
    }));

    // Handle updating the network
    $('#settings-network').change(function(){
        // Make sure wallet is unlocked
        if(dialogCheckLocked('change wallet networks'))
            return;
        var net = $(this).val();
        setWalletNetwork(net);
    });

    // Handle allowing large tx fee
    $('#settings-largefee').change(function(){
       var allow = $(this).val() || 0;
       setAllowLargeTXFee(allow);
    });

});
</script>
